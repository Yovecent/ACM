# ğŸ¬[P2680 [NOIP2015 æé«˜ç»„] è¿è¾“è®¡åˆ’](https://www.luogu.com.cn/problem/P2680)  


![image](https://user-images.githubusercontent.com/92497177/138579286-3706db40-17e7-4792-9ba2-c498520dfc6a.png)  

    ğŸ«å› ä¸ºæ˜¯ä»»åŠ¡åŒæ—¶è¿›è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿æœ€å¤§å€¼æœ€å°ï¼Œå¯ä»¥è€ƒè™‘äºŒåˆ†ï¼Œç„¶åæˆ‘ä»¬äºŒåˆ†çš„å°±æ˜¯å¯è¡Œçš„æœ€å°å€¼
    å¯¹äºcheckå‡½æ•°ï¼Œæˆ‘ä»¬è¦éªŒè¯æ˜¯å¦èƒ½ä½¿æœ€å¤§å€¼å˜ä¸º<=mid,çš„è¯ï¼Œå°±æ˜¯æ‰¾åˆ°ä¸€æ¡åœ¨æ‰€æœ‰å¤§äºmidçš„è¾¹ä¸­éƒ½æœ‰çš„ä¸€æ¡è¾¹ï¼Œç„¶åæ±‚å‡ºè¿™ç§è¾¹çš„æœ€å¤§å€¼
    éªŒè¯æ˜¯å¦æˆç«‹ã€‚
    
```C++
#include <iostream>
#include <cstdio>
#include <algorithm>
#include <cstring>

using namespace std;
const int maxn = 3e5+10;

int head[maxn<<1],n,m,cnt=0,dis[maxn],fa[maxn][20],dep[maxn];
int temp[maxn],pos,c[maxn],Max;
struct node{
    int Next,to,w;
}ed[maxn<<1];
struct P{
    int u,v,D;
}p[maxn<<1];

void add(int u,int v,int w){

    ed[cnt].to=v;
    ed[cnt].w=w;
    ed[cnt].Next=head[u];
    head[u]=cnt++;
}

void dfs(int u,int pre){

    for(int i = head[u]; ~i ; i=ed[i].Next){
        int to=ed[i].to,w=ed[i].w;
        if(to == pre)  continue;
        dis[to]=dis[u]+w;
        dep[to]=dep[u]+1;
        fa[to][0]=u;
        for(int i = 1; i <= 19 ; i++){
            fa[to][i]=fa[fa[to][i-1]][i-1];
        }
        dfs(to,u);
    }
}

inline int LCA(int x,int y){

    if(dep[x]>dep[y]) swap(x,y);
    for(int i = 19 ; i >= 0 ; i--){
        if(dep[fa[y][i]] >= dep[x]) y=fa[y][i];
    }
    if(x == y)  return x;
    for(int i = 19 ; i >= 0 ; i--){
        if(fa[x][i] != fa[y][i]) x=fa[x][i],y=fa[y][i];
    }
    return fa[x][0];
}

inline void dfs2(int u,int pre,int w){

    for(int i = head[u]; ~i ; i=ed[i].Next){
        int to=ed[i].to,w=ed[i].w;
        if(pre == to)  continue;
        dfs2(to,u,w);
        c[u]+=c[to];
    }
    if(c[u] == m-pos+1){//åªæœ‰è¢«æ‰€æœ‰å¤§äºmidçš„è¾¹éƒ½è¦†ç›–ä¹‹åæ‰å¯ä»¥è¢«é€‰
        Max = max(Max,w);
    }
}
inline bool check(int mid){

    pos=upper_bound(temp+1,temp+m+1,mid)-temp;æ‰¾åˆ°æ‰€æœ‰å¤§äºmidçš„è¾¹
    if(pos == m+1)  return true;
    for(int i = 1; i <= n ; i++)  c[i]=0;
    for(int i = pos ; i <= m ; i++){
        int x=p[i].u,y=p[i].v;
        c[x]++,c[y]++,c[LCA(x,y)]-=2;æ ‡è®°ä¸¤ç‚¹ä¹‹é—´çš„æ‰€æœ‰è¾¹
    }
    Max=-1;
    dfs2(1,0,0);
    if(Max == -1)  return false;
    if(p[m].D - Max <= mid)  return true;
    return false;
}
int main()
{
#ifndef ONLINE_JUDGE
    freopen("in.txt", "r", stdin);
    freopen("out.txt", "w", stdout);
#endif
    memset(head,-1,sizeof head);
    scanf("%d %d",&n,&m);
    for(int i = 1; i <= n-1 ; i++){
        int x,y,w;scanf("%d %d %d",&x,&y,&w);
        add(x,y,w);add(y,x,w);
    }
    dfs(1,0);
    for(int i = 1 ; i <=  m; i++){
        int x,y;scanf("%d%d",&x,&y);
        p[i].u=x,p[i].v=y,p[i].D=dis[x]+dis[y]-2*dis[LCA(x,y)];
    }
    sort(p+1,p+m+1,[](P x,P y){
        return x.D < y.D;
    });
    for(int i = 1; i <= m ; i++) temp[i]=p[i].D;
    int l=0,r=p[m].D;
    while(l<r){
        int mid=l+r-1>>1;
        if(check(mid)) r=mid;
        else           l=mid+1;
    }printf("%d\n",r);
    return 0;
}
```
