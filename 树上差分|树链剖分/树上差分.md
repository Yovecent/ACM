# æ ‘ä¸Šå·®åˆ†

    ğŸ’¥ä¸ºäº†å­¦æ ‘é“¾å‰–åˆ†ï¼Œæ‰€ä»¥å°±å…ˆå­¦ä¹ äº†ä¸€ä¸‹æ ‘ä¸Šå·®åˆ†ï¼Œæ„Ÿè§‰å¯¹äºæˆ‘è¿™ä¸ªèœé¸¡çœŸçš„å¾ˆéš¾å•Š.
 

## é¦–å…ˆæ ‘ä¸Šå·®åˆ†åˆ†ä¸º  å¯¹ç‚¹å·®åˆ†ä»¥åŠå¯¹è¾¹å·®åˆ†
ğŸ¥‡ç‚¹å·®åˆ†   

    ç‚¹å·®åˆ†å…¶å®å°±ç±»ä¼¼äºä¸€ç»´å·®åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å¯¹äºä¸¤ä¸ªç‚¹v,uæˆ‘ä»¬å¦‚æœæƒ³è¦è®©è¿™ä¸¤ç‚¹ä¹‹é—´çš„æ‰€æœ‰ç‚¹çš„æƒå€¼éƒ½åŠ ä¸Šxçš„è¯ï¼Œå¯ä»¥è€ƒè™‘å…ˆæ±‚å‡ºè¿™ä¸¤ä¸ªç‚¹çš„LCA,
    ç„¶åæˆ‘ä»¬å°±æŠŠä»uåˆ°LCAï¼Œä»¥åŠvåˆ°LCAä¹‹é—´çš„ç‚¹çš„æƒå€¼éƒ½åŠ ä¸Šx,è¿™æ ·åšçš„ç›®çš„æ˜¯ï¼Œåœ¨æ ‘ä¸­ï¼Œå¯¹äºæ ¹å·²ç»ç¡®å®šä¹‹åï¼Œä»–ä¾¿åªæœ‰ä¸€ä¸ªçˆ¶ä»£ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ ‡è®°äº†vä¸u
    ä¹‹åï¼Œåœ¨å›æº¯çš„çš„æ—¶å€™ï¼Œåˆ©ç”¨å‰ç¼€å’Œçš„æ–¹æ³•ï¼Œè®©è¿™ä¹‹é—´çš„æ‰€æœ‰ç‚¹éƒ½åŠ ä¸Šäº†xï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜å¾—è®©æŸäº›ç‚¹åœ¨å‡å»xè¿™æ ¹ä¸€ç»´çš„æ€æƒ³æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬è®©LCA-x
    çš„è¯ï¼Œå¯ä»¥ä¿è¯LCAé™¤åŠ äº†xå› ä¸ºæ˜¯æ¥é‚£ä¸ªè¾¹éƒ½æœ‰ä¸€ä¸ªxï¼Œä½†è¿˜éœ€åœ¨fa[LCA]å¤„åœ¨å»ºä¸€ä¸ªxï¼Œè¿™æ ·å°±èƒ½ä¿è¯ä¸ä¼šå¤šã€‚


å¯¹åº”çš„ä¸€é“æ¨¡æ¿é¢˜
[P3128 [USACO15DEC]Max Flow P](https://www.luogu.com.cn/problem/P3128)  
ğŸ©¹ç„¶åé™„ä¸Šä»£ç ï¼š
```C++
#include <iostream>
#include <cstdio>
#include <vector>
#include <algorithm>

#define ep(x) emplace_back(x)
using namespace std;
const int maxn = 5e5+10;
vector<int>v[maxn];
inline int read(){ 
    int s=0;
    char c=getchar();
    while (c<'0' || c>'9') c=getchar();
    while (c>='0' && c<='9') s=s*10+c-'0',c=getchar();
    return s;
}

inline int lca(int x,int y){
    if(dep[x] > dep[y]) swap(x,y);
    for(int i = 20 ; i >= 0 ; i--){
        if(dep[fa[y][i]] >= dep[x]) y=fa[y][i];
    }
    if(x == y) return x;
    for(int i = 20 ; i >= 0 ; i--){
        if(fa[x][i]!=fa[y][i]) x=fa[x][i],y=fa[y][i];
    }
    return fa[x][0];
}

inline void dfs(int u,int pre){

    for(auto to : v[u]){
        if(to == pre)  continue;
        dfs(to,u);
        p[u]+=p[to];
    }
    Max=max(p[u],Max);
}
int main()
{
#ifndef ONLINE_JUDGE
    freopen("in.txt", "r", stdin);
    freopen("out.txt", "w", stdout);
#endif
    int n,m;n=read();m=read();
    for(int i = 1 ; i <= n-1 ; i++){
        int x,y;x=read();y=read();
        v[x].ep(y),v[y].ep(x);
    }
    dep[1]=1;
    work(1,0);
    for(int i = 1; i <= m ; i++){
        int x,y;x=read();y=read();
        int Fa=lca(x,y);
        p[x]++,p[y]++,p[Fa]--,p[fa[Fa][0]]--;
    }
    dfs(1,0);
    printf("%d\n",Max);
    return 0;
}
```

ğŸ¥ˆè¾¹å·®åˆ† 
    ç¬¬äºŒä¸ªå°±æ˜¯è¾¹å·®åˆ†äº†ï¼Œå…¶å®æ€è·¯å’Œç‚¹çš„å·®ä¸å¤šï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä»¬è®¾äº†ä¸€ä¸ªtempæ•°ç»„ï¼Œtemp[u],ä»£è¡¨uåˆ°uçš„çˆ¶ä»£çš„è¾¹æƒå€¼ï¼Œæ˜¯ä¸æ˜¯å¾ˆå·§å¦™ã€‚
    ç„¶åæˆ‘ä»¬å¦‚æœæƒ³è®©v,uä¹‹é—´çš„æ‰€æœ‰è¾¹éƒ½åŠ ä¸Šä¸€ä¸ªè¾¹æƒï¼Œæˆ‘ä¹ˆè¿˜æ˜¯æ±‚å‡ºå…¶LCA,ç„¶åæˆ‘ä»¬è®©temp[v],temp[u]å‡ºåŠ ä¸Šxï¼Œç„¶åç›´æ¥è®©temp[LCA]é™¤-2xå°±å¯ä»¥äº†ï¼Œ
    å› ä¸ºæ ¹æ®tempçš„å®šä¹‰ï¼Œtemp[LCA]æ˜¯ä¸å±äºuåˆ°vä¹‹é—´çš„è¾¹çš„æ‰€ä»¥ç›´æ¥å‡ä¹‹åå°±éƒ½ä¸ç”¨è€ƒè™‘äº†ã€‚
    
[P2680 [NOIP2015 æé«˜ç»„] è¿è¾“è®¡åˆ’](https://www.luogu.com.cn/problem/P2680)  

é™„ä¸Šä»£ç ï¼š
```C++
#include <iostream>
#include <cstdio>
#include <algorithm>
#include <cstring>

using namespace std;
const int maxn = 3e5+10;

int head[maxn<<1],n,m,cnt=0,dis[maxn],fa[maxn][20],dep[maxn];
int temp[maxn],pos,c[maxn],Max;
struct node{
    int Next,to,w;
}ed[maxn<<1];
struct P{
    int u,v,D;
}p[maxn<<1];

void add(int u,int v,int w){

    ed[cnt].to=v;
    ed[cnt].w=w;
    ed[cnt].Next=head[u];
    head[u]=cnt++;
}

void dfs(int u,int pre){

    for(int i = head[u]; ~i ; i=ed[i].Next){
        int to=ed[i].to,w=ed[i].w;
        if(to == pre)  continue;
        dis[to]=dis[u]+w;
        dep[to]=dep[u]+1;
        fa[to][0]=u;
        for(int i = 1; i <= 19 ; i++){
            fa[to][i]=fa[fa[to][i-1]][i-1];
        }
        dfs(to,u);
    }
}

inline int LCA(int x,int y){

    if(dep[x]>dep[y]) swap(x,y);
    for(int i = 19 ; i >= 0 ; i--){
        if(dep[fa[y][i]] >= dep[x]) y=fa[y][i];
    }
    if(x == y)  return x;
    for(int i = 19 ; i >= 0 ; i--){
        if(fa[x][i] != fa[y][i]) x=fa[x][i],y=fa[y][i];
    }
    return fa[x][0];
}

inline void dfs2(int u,int pre,int w){

    for(int i = head[u]; ~i ; i=ed[i].Next){
        int to=ed[i].to,w=ed[i].w;
        if(pre == to)  continue;
        dfs2(to,u,w);
        c[u]+=c[to];
    }
    if(c[u] == m-pos+1){
        Max = max(Max,w);
    }
}
inline bool check(int mid){

    pos=upper_bound(temp+1,temp+m+1,mid)-temp;;
    if(pos == m+1)  return true;
    for(int i = 1; i <= n ; i++)  c[i]=0;
    for(int i = pos ; i <= m ; i++){
        int x=p[i].u,y=p[i].v;
        c[x]++,c[y]++,c[LCA(x,y)]-=2;
    }
    Max=-1;
    dfs2(1,0,0);
    if(Max == -1)  return false;
    if(p[m].D - Max <= mid)  return true;
    return false;
}
int main()
{
#ifndef ONLINE_JUDGE
    freopen("in.txt", "r", stdin);
    freopen("out.txt", "w", stdout);
#endif
    memset(head,-1,sizeof head);
    scanf("%d %d",&n,&m);
    for(int i = 1; i <= n-1 ; i++){
        int x,y,w;scanf("%d %d %d",&x,&y,&w);
        add(x,y,w);add(y,x,w);
    }
    dfs(1,0);
    for(int i = 1 ; i <=  m; i++){
        int x,y;scanf("%d%d",&x,&y);
        p[i].u=x,p[i].v=y,p[i].D=dis[x]+dis[y]-2*dis[LCA(x,y)];
    }
    sort(p+1,p+m+1,[](P x,P y){
        return x.D < y.D;
    });
    for(int i = 1; i <= m ; i++) temp[i]=p[i].D;
    int l=0,r=p[m].D;
    while(l<r){
        int mid=l+r-1>>1;
        if(check(mid)) r=mid;
        else           l=mid+1;
    }printf("%d\n",r);
    return 0;
}
```
```diff
æ‰€ä»¥æ€»çš„æ¥è¯´ä¸¤ä¸ªçš„æ­¥éª¤æ˜¯ï¼š
+ ç‚¹å·®åˆ†   åœ¨u,vä¸¤ä¸ªç‚¹å¤„åŠ ä¸Šxï¼Œç„¶ååœ¨LCAå¤„-xï¼Œç„¶ååœ¨fa[LCA]-x;
+ è¾¹å·®åˆ†   åœ¨u,vä¸¤ä¸ªç‚¹å¤„åŠ ä¸Šxï¼Œç„¶ååœ¨LCAå¤„-2x
```
   
## ç„¶åå†è¯´ä¸€ä¸‹å†™çš„åŸºæœ¬æ¨¡æ¿

```C++

void add(int u,int v,int w){//é“¾å¼å‘å‰æ˜Ÿ

    ed[cnt].to=v;
    ed[cnt].w=w;
    ed[cnt].Next=head[u];
    head[u]=cnt++;
}

void dfs(int u,int pre){

    for(int i = head[u]; ~i ; i=ed[i].Next){
        int to=ed[i].to,w=ed[i].w;
        if(to == pre)  continue;
        dis[to]=dis[u]+w;//ä»æ ¹åˆ°è¿™ä¸ªç‚¹çš„è¾¹æ€»æƒé‡
        dep[to]=dep[u]+1;//æ·±åº¦
        fa[to][0]=u;
        for(int i = 1; i <= 19 ; i++){
            fa[to][i]=fa[fa[to][i-1]][i-1];//æ±‚å…¶çˆ¶ä»£
        }
        dfs(to,u);
    }
}

inline int LCA(int x,int y){//å€å¢æ±‚LCA

    if(dep[x]>dep[y]) swap(x,y);
    for(int i = 19 ; i >= 0 ; i--){
        if(dep[fa[y][i]] >= dep[x]) y=fa[y][i];
    }
    if(x == y)  return x;
    for(int i = 19 ; i >= 0 ; i--){
        if(fa[x][i] != fa[y][i]) x=fa[x][i],y=fa[y][i];
    }
    return fa[x][0];
}

inline void dfs2(int u,int pre,int w){

    for(int i = head[u]; ~i ; i=ed[i].Next){
        int to=ed[i].to,w=ed[i].w;
        if(pre == to)  continue;
        dfs2(to,u,w);
        c[u]+=c[to];//ç»Ÿè®¡è¾¹çš„è®°å½•æ¬¡æ•°
    }
    if(c[u] == m-pos+1){
        Max = max(Max,w);
    }
}
```
    
    
