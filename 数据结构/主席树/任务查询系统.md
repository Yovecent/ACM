# [ä»»åŠ¡æŸ¥è¯¢ç³»ç»Ÿ](https://www.luogu.com.cn/problem/P3168)
    
    
    å†™è¿™é“é¢˜æ†¨æ‰¹äº†ï¼Œå…¶å®å°±æ˜¯ä¸æ–­åœ°å•ç‚¹ä¿®æ”¹çš„æ“ä½œã€‚
    
    å®šä¹‰é¢åŒºé—´å«ä¹‰ä¸ºpçš„å€¼åŸŸï¼ŒåŒæ—¶ç”¨sizesæ¥è¡¨ç¤ºåŒºé—´å«æœ‰çš„å€¼çš„ä¸ªæ•°ï¼Œsumè®°å½•å…¶çœŸå®å€¼çš„æ€»å’Œï¼Œé‚£ä¹ˆ
    æˆ‘ä»¬å°±æ˜¯åœ¨ä¸æ–­çš„ä¿®æ”¹ç‚¹ç„¶ååœ¨æŸ¥è¯¢ï¼Œè¿™é‡Œæ—¶æŸ¥è¯¢å‰kå°çš„ï¼Œé‚£æˆ‘ä»¬å°±ä¸æ–­çš„ç»Ÿè®¡å·¦è¾¹çš„ï¼Œä¸ä¹‹å‰çš„é‚£ä¸ªæ¨¡æ¿é¢˜çš„æ–¹å‘ä¸ä¸€æ ·ã€‚
    å”¯ä¸€åŒºåˆ«çš„å°±æ˜¯æŠŠæ—¶é—´ç‚¹è®¾ç½®åœ¨vectoré‡Œé¢ï¼Œç„¶ååœ¨çº¿ä¿®æ”¹ï¼Œæ”¹å®ŒæŸ¥ä¸€ä¸‹å°±è¡Œäº†ã€‚
    
    
```C++
#include <bits/stdc++.h>

#define L(x)  (tr[x].l)
#define R(x)  (tr[x].r)
#define endl  "\n"
using namespace std;
using i64 = long long;
typedef pair<int,int> pii;
const int maxn = 1e5 + 10;

int root[maxn], cnt, pre[maxn], is[maxn], nod, tot;
i64 ans[maxn];
vector<int>v[maxn];
struct Chairman_Tree{
    
    struct node{
        int l, r, sizes;
        i64 sum;
    }tr[maxn * 40];
    void update(int &now, int l, int r, int x, int k){
        tr[++cnt] = tr[now], now = cnt;
        tr[now].sum += pre[x] * k; tr[now].sizes += k;
        if(l == r) return;
        int mid = l + r >> 1;
        if(x <= mid) update(L(now), l, mid, x, k);
        else         update(R(now), mid + 1, r, x, k);
    } 
    i64 query(int now, int l, int r, int num){

        if(l == 1 && r == tot && tr[now].sizes <= num){
            return tr[now].sum;
        }
        if(l == r ){
            return 1ll * pre[l] * num;
        }
        int mid = l + r >> 1;
        int x = tr[L(now)].sizes;
        if(x >= num) return query(L(now), l, mid, num);
        else         return query(R(now), mid + 1, r, num - x) + tr[L(now)].sum ;
    }
    
}tree;
int main()
{
#ifndef ONLINE_JUDGE
    freopen("in.txt", "r", stdin);
    freopen("out.txt", "w", stdout);
#endif

    int m, n;  cin >> m >> n;
    vector<int>d;
    for(int i = 1; i <= m ; i++){
        int a,b,c;  cin >> a >> b >> c;
        v[a].push_back(c); v[b + 1].push_back(-c);
        d.push_back(c);
    }

    sort(d.begin(), d.end());
    d.erase(unique(d.begin(), d.end()), d.end());
    tot = d.size();
    
    for(int i = 1; i < maxn ; i++){
        root[i] = root[i - 1];
        for(auto x : v[i]){
            int y = lower_bound(d.begin(), d.end(),abs(x)) - d.begin() + 1;
            pre[y] = abs(x);
            int k = x <= 0 ? -1 : 1;
            tree.update(root[i], 1, tot, y, k);
        }
    }

    ans[0] = 1;
    for(int i = 1; i <= n ;i++){
        int x, a, b, c;  cin >> x >> a >> b >> c;
        int k = (a * ans[i - 1] + b) % c + 1;
        ans[i] = tree.query(root[x], 1, tot, k);
        cout << ans[i] <<  endl;
    }
    return 0;
}
```

```diff
!    2022-03-30ğŸ»
```
